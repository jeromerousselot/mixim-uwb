#!/bin/bash

set -e

echo ""
echo "-------------------------------------------------------------------------------"
echo "-- Running tests and collecting results ---------------------------------------"
echo "-------------------------------------------------------------------------------"
(opp_runall ./run -d -- -c General -u Cmdenv "$@" || echo "FAILED: run aborted") | tee out.tmp
echo ""
echo "-------------------------------------------------------------------------------"
echo "-- Passed tests ---------------------------------------------------------------"
echo "-------------------------------------------------------------------------------"
cat out.tmp | egrep "^Passed:"
echo ""
echo "-------------------------------------------------------------------------------"
echo "-- Failed tests----------------------------------------------------------------"
echo "-------------------------------------------------------------------------------"
cat out.tmp | egrep "^FAILED:" && exit 1 || echo "none."
echo ""
